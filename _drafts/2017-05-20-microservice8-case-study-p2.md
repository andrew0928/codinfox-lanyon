---
layout: post
title: "架構師觀點 - 轉移到微服務架構的經驗分享 (Part 2)"
categories:
- "系列文章: .NET + Windows Container, 微服務架構設計"
- "系列文章: 架構師觀點"
tags: ["microservice", "系列文章", "ASP.NET", "架構師", "Docker", "Windows Container", "DevOps"]
published: true
comments: true
redirect_from:
logo: 
---



<!--more-->

{% include series-2016-microservice.md %}


--

前情提要: [架構師觀點 - 轉移到微服務架構的經驗分享 (Part 1)](/2017/04/15/microservice8-case-study/)


--

# 實際轉移案例

上一篇講到: 轉移到微服務架構是有條件的，基本門檻還達不到的話就貿然轉移到微服務架構是很冒險的。微服務架構先天就較複雜，在
開發、部署及維運這三個部份的要求都比單體式架構的 APP 來的高。因此我過去的經驗中，我是採取比較保守的策略在做這件事。什麼
叫 "保守"? 意思是我會先花很多時間研究及了解微服務架構的優缺點，也會花時間逐一進行 POC 驗證每個改變的環節是否都能順利進行。
而不是貿然的就把既有的服務整個打掉重練。

因此，我把既有的服務架構作了規劃，安排如何一步一步地進行微服務化。許多微服務化的架構建議我並沒有採用，因為我們的服務規模
還不夠大，投入在這些環節上，短時間只會造成困擾，而不會有具體的改善，這類狀況我只要確保現在的架構不會成為將來進一步改進的
阻礙就可以了。

在開始之前，先來看看舊架構的系統概況跟規模吧! 我試著盡量具體的量化 "規模" :

![](2017-05-14-00-48-13.png)

之前改造的服務，是人資相關的系統，用於數位學習及人才發展的管理。這類系統的特色就是表單特多，流程複雜。
這特色造成程式碼之間的耦合度過高，維護的成本居高不下，因此降低維護的複雜度是主要目標。另外，這系統需要同時提供單機版本的建置 (private cloud), 同時也提供雲端服務及代管模式 (saas, public cloud)。讓軟體架構同時適應這兩種 hosting 環境也是改版的目標之一。

![](2017-05-14-00-58-51.png)

接著來看看改變之前的系統架構圖吧! 基本上就是很傳統，WEB + DB 的典型架構。其中 business logic 雖然有適當的切割 (用 library 的型態)，
但是在執行期間仍然是被放在同一個 process，部署的架構上並沒有明確的將之獨立出來。除此之外，因為系統包含數位學習，需要管理大量的
教材內容，因此多了 storage service 與 content server 的延伸架構。

各位可以想像一下，這狀況其實完全命中了微服務架構想解決的問題點啊! 這麼大規模的 code base, 改了任何一行就需要整個服務重新部署，
我們在這樣的基礎上導入了 CI / CD, 但是冗長的編譯時間也導致 CI / CD 的作用大打折扣。另外，商業邏輯也包含在 WEB 內，任何一個
模組失效 (如 out of memory exception 等等) ，都會導致整個系統掛掉...。

在當時，我歸納了整個系統架構上有四項主要的問題等著被解決:

![](2017-05-14-02-23-59.png)

即使如此，微服務架構仍然不是萬靈丹，因為前面有提到，微服務架構是有進入門檻與代價的啊! 經過評估之後，我們決定按照實際問題的影響程度，
逐步進行改善。對我們當時的狀況而言，最優先處理的是 **維護困難**、還有 **雲端化困難** 這兩項。而 **部署困難** 則是緊接著雲端化
問題解決後緊接著會面臨的問題，因此也一併考慮在內。因此我們著手進行微服務化架構的改進，切割的策略及進行順序都按照這重要性來安排。

回顧這決策的過程，我覺得這篇文章最能描述我當時的心境了! 這是在事後才讀到的文章，不過這篇文章講的內容完全就是我當初思考的啊!
不分享不行，我特地花了點篇幅來介紹這篇文章要講的內容...

# 一窩蜂驅動開發!!


![](2017-05-14-02-30-48.png)
原文: [一窩蜂驅動開發](https://blog.chunfuchao.com/?p=656&variant=zh-tw)  

我只能說，這篇文章講的實在太傳神，太到位了! 甚至文內舉了幾個常見的例子，就包含了微服務架構 XD，根本完全命中我擔心的狀況啊...

![](2017-05-14-02-32-22.png)