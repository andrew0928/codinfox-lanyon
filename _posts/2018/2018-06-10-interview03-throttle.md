---
layout: post
title: "架構面試題 #3, 執行速率控制"
categories:
- "系列文章: .NET + Windows Container, 微服務架構設計"
- "系列文章: 架構師觀點"
tags: ["架構師", "面試經驗", "microservices"]
published: false
comments: true
redirect_from:
logo: 
---

面試題這系列來到第三篇，這次換一個應用題，來考考比較屬於 operation 層面的應用: 流量 (或是呼叫次數) 的管控。

簡單的說，這問題翻成白話就是: "某 API 一分鐘可以呼叫 60 次" 的功能該如何設計，如此而已。別小看這類問題，看似簡單，實作上要解決的障礙還不少。面試階段我會問這問題，自然不是要你馬上寫出 production code 給我看，重點是要看看你思考問題的方向有沒有概念? 有沒有善用抽象化思考的技巧，排除困難的實作部分，思考關鍵複雜的核心問題?

核心問題分兩部分: 

1. 如何定義 "流量"?
  如何得知目前的 "流量" 是多少? 這部分考驗的是定義問題的能力。通常這類問題需求單位很難定義的很精準，因此都要仰賴技術單位來支援。這考驗寫技術規格以及演算法等等基本技巧的考驗；
1. 流量超過預期上限之後的處理方式?
  超過流量上限之後，是延遲這個 task, 直到流量低於限制再執行? 還是直接回覆 error ? 延遲過久可能會造成連線數量暴增，阻斷了其它正常的流量.. 引發額外的問題；回應 error 則間接的把問題交由 client side 處理，也會增加 API 與整體系統的複雜度。
  這邊會用到多執行緒控制，非同步的控制等等相關技巧。

<!--more-->

這系列文章，我是定位在 "建構微服務開發團隊" 這前題而準備的面試題目。目的是找出能夠思考及解決問題的人，我期望團隊裡的人解決問題時，第一時間是思考問題的核心是什麼? 接著才是思考有哪些現成的 framework / service 可以用? 或是必須要自己開發? 沒有這層抽象化思考能力的人，往往第一時間就會跳到他熟悉的 framework / service 身上去了，錯過了其它可能更合適的可能性。現成的方案不見得不好，但是通常整合程度會差一些，你也有可能為了殺一隻雞去買整套牛刀回來...。這種狀況在一般軟體開發其實還好 (都很成熟了)，但是在微服務開發的領域上，這問題就被放大了。因為微服務還是個發展中的架構，很多狀況下不會有標準作法...。

流量管控，背後的意義就是對於服務的 loading 控制，以及超過上限的處理，其實微服務架構常常談到的 "斷路器" (circuit breaker) 要解決的就是這類問題。在你急著找各種微服務框架的斷路器 framework 之前，先好好了解一下這問題的本質吧! 這樣的好處是，即使你是使用現成的 framework, 你也能適度的抽象化 (訂定內部的 interface), 即使需要更換底層的框架或是服務，也能盡可能的降低影響。











我猜大部分的 developer 都很不擅長處理這類問題吧 (我自己就是)! 這類跟功能沒有直接關聯，而是為了成本，效能，或是資源使用做管控目的的設計，通常都不會被擺在第一順位，測試上也不是那麼容易，因為這類問題很容易因為環境或是設備的不同，就跑出不同的結果


這類跟時間有關，流量控制或是 IOPS (I/O per second) 
