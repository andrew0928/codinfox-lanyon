---
layout: post
title: "網站升級: CommunityServer 2007.1"
categories:
- "Community Server"
- "技術隨筆"
- "有的沒的"
- "水電工"
tags: ["Community Server","技術隨筆","有的沒的","水電工"]
published: true
comments: true
permalink: "/2007/11/12/網站升級-communityserver-2007-1/"
redirect_from:
  - /columns/post/2007/11/12/e7b6b2e7ab99e58d87e7b49a-CommunityServer-20071.aspx/
  - /post/2007/11/12/e7b6b2e7ab99e58d87e7b49a-CommunityServer-20071.aspx/
  - /post/e7b6b2e7ab99e58d87e7b49a-CommunityServer-20071.aspx/
  - /columns/2007/11/12/e7b6b2e7ab99e58d87e7b49a-CommunityServer-20071.aspx/
  - /columns/e7b6b2e7ab99e58d87e7b49a-CommunityServer-20071.aspx/
  - /blogs/chicken/archive/2007/11/12/2806.aspx/
wordpress_postid: 135
---
<p>
周日下午趁小孩都回外婆家, 花了點時間把家裡該裝的裝一裝, 該接的接一接, 還有一點空檔, 就把拖了很久的網站升級處理一下... 原本的版本是 CS 2007 (3.0), 中間推出了 3.0 SP1, SP2, SP3 beta 都跳過去沒理它, 這次 2007.1 (3.1) 出來手又癢了起來...
</p>
<p>
過程就沒啥好說了, 失敗了好幾次, 最後決定整個重裝... 抓了 2007.1 的官方版本, 把舊的 db 配上它的 upgrade script 執行完後掛上去, 基本功能就會動了, 最後再把 ~/blogs, ~/photos, ~/forums 等有 storage 的目錄搬過去, 再把我自己客制過的 themes 重改一次 ( my god, themes 裡的檔案全都調過, 原本的 themes 蓋過來可以跑, 不過心裡毛毛的 )... 總算大功告成. 事後順手也把同一台 server 另外兩套 CS 也順便升級了一下.
</p>
<p>
老實說我也沒很注意 2007.1 到底改了啥, 就貼一下吧, 搞不好大家之前碰到的鳥問題已經被解決掉了... 正好鴕鳥混過去, 哈哈 [H]
</p>
<p>
以下是 CS2007.1 release notes:
</p>
<p>
Below are changes available in Community Server 2007.1<br />
------------------------------------------------------------------- 
</p>
<p>
Enhancements<br />
- Updated caching framework, performance updates, added locking support for several of the application-wide collections<br />
- SQL performance updates and best-practices updates<br />
- Added CreateEditWeblogPostForm, DeleteWeblogPostForm, and associated sub-form controls from CS2008 to support creating/editing/deleting blog posts in the front UI using Chameleon.<br />
- Updated styles on the TinyMCE wrapper&#39;s content to provide some default spacing and use a larger default font size.<br />
- Updated TagCloud controls to support disabling the &quot;no tags&quot; message and &quot;no related tags&quot; messages.&nbsp; Updated all existing themes (except for tag browsing pages) to not render the &quot;no tags&quot; message.<br />
- Updated SqlProviders to resolve LINQ SortOrder namespace ambiguity<br />
- Added support for sorting and paging LinkCategory and Link objects in the API and via Chameleon.<br />
- Added toggle button for enabling/disable application tokens<br />
- Tweaked app tokens list a little bit to show the time for the last used column<br />
- Added a new AdPlacementOptions to WrappedRepeater, AlternatingSeperator - places an ad after every other item starting after the first. <br />
- Updated TinyMCE to use the latest wrapper.<br />
- Updated the email job only retrieves as many messages as it will send from the email queue (prevent large queues from causing timeouts)<br />
- Updated notifications and mass emails to enforce the check on a user&#39;s &quot;Enable Email&quot; global setting and &quot;Allow Site to contact me&quot; setting<br />
- Updated email notifications to check the enable thread tracking for post replies<br />
- Updated mass emailing to take place on a background thread<br />
- Updated Telligent.Registration.dll to address an issue where the add-ons could get stuck if they start before SQL on a reboot/startup<br />
- Updated Telligent.MailGateway.Common.dll to address issues with XML cleaning in the core library and downloading only as many messages as needed from the email queue<br />
- Updated user date formats so that month-day-year is 6-1-2007 instead of 06-01-2007<br />
- Updated Windows Live Writer support by implementing keywords for custom tags and removing excerpt support since it gets confused with text-mode.<br />
- The error messages were updated so that the actual error message is displayed more prominently.<br />
- Removed the AutoDeleteThreshold setting from the forum control panel since it is not implemented.<br />
- Updated stylesheet to not underline the group expand/collapse toggle button.<br />
- Updated version of CookComputing XML-RPC.NET library to use new .NET 2.0 optimized verison<br />
- Updated list of default Weblog Ping URLS (removed Blo.gs and PubSub.com, added PingOMatic.com)<br />
- Implemented TruncationEllipsisTemplate on the ObjectDataBase control to support custom markup/controls being used in the TruncationEllipsis<br />
- Enabled adding new categories inline through Windows Live Writer<br />
- Added rsd.ashx and wlwmanifest.ashx in web project, and added namespaces (Added support for RSD and WLWManifest).<br />
- Updated MetaBlog to support excerpts, read-more, and post names<br />
- Updated blog truncation to use readmore links<br />
- Updated Metablog to default to the users current blog<br />
- Added auto discovery for the current blogs metablog path<br />
- Added basic site and blog theme<br />
- Updated email templates for forum and forum thread emails to remove the background grey color.<br />
- CSContext.User is only overridden with TokenUser when told via AllowTokenRequests(bool requirePrivateToken)<br />
- Added rendering of news to the &quot;Traveler&quot; blog theme&#39;s sidebar.<br />
- Added support for TemporaryUserTokens that expire after 3 hours<br />
- Change password now uses a temporary user token<br />
- Added support for disabling exception logging. It is disabled by default.<br />
- Moved keep-alive code from global.js into the KeepAlive control.&nbsp; Updated Editor control to *always* render a KeepAlive control.&nbsp; Deleted web/utility/keepalive.aspx<br />
- Added a few performance improvements to ThreadQueryBuilder classes: Only joining to cs_threads if we really have to, Adding a cs_Sections.ApplicationType filter back in<br />
- Changed the expiration date from 30 days to 7<br />
- Exception logging now occurs in background cache tasks 
</p>
<p>
Bug Fixes:<br />
- FileSystemWatcher pathing fix<br />
- Request/Response encoding fix<br />
- You can now resize the editor horizontally in the content editor modals<br />
- You can now override an editor option without specifying type on the control<br />
- You are no longer redirected to login when browsing a site that has forums at root while you are anonymous.<br />
- Updated inline text editor to not overlap its popup container<br />
- Updated Telligent.Glow.Modal to use frameborder=&#39;0&#39; instead of frameborder=&#39;no&#39;<br />
- Create/Edit Blog Page Validation fixed so that appkey cannot be blank<br />
- Added code and note bbcode and updated existing processing order of scrubbing modules<br />
- Enabled checking of the user&#39;s Enable Email setting on a wide variety of message types<br />
- Corrected all references in Chameleon controls to OpenWindow function in global.js to use a direct call to window.open.<br />
- Updated Forum BreadCrumb control to use the current rewritten URL name instead of the rendered URL to determine the current page<br />
- Updated EntryThumbnail control to render the file extension in the alt attribute.<br />
- Updated EntryThumbnail control to render with an Image control and default to 0 border width and no alignment.<br />
- The parent post cache is now expired properly when creating a new post in a thread.&nbsp; This allows a reply to post to always display in a thread after it is created.<br />
- Create edit blog post now maintains state better<br />
- Added validation for the user&#39;s email address to Users.Create<br />
- Fix for Gallery search results from searchbarrel linking to image not to gallery page<br />
- Removed the ability to rename or delete the anonymous user<br />
- Fixed issue where GalleryService.Update failed to set the PostID, which caused it to always fail.<br />
- Updated cs_User_Delete sproc to update author/post ID&#39;s as well as names<br />
- Disabled subforums no longer require user to login in parent forum<br />
- Fixed theme cache name so that the cache key is correct.&nbsp; Previously theme configuration were never getting retrieved from cache correctly.<br />
- Changed create user page so that validation occurs when fields change as oppose to whenever a key was pressed.<br />
- Group RSS Feed no longer causes Exception<br />
- Pager added to the default aggregateentrylist control for the file gallery<br />
- Clicking the Advanced Search link from a search results page now populates the advanced search options form for the lean and green theme as well as default<br />
- Corrected QuickReply link to only refresh the page if false (and not undefined OR false) is passed as the callback parameter.<br />
- Fixed EXIF page to show the full list of tags.<br />
- Fixed photo post edit so it decodes the subject before populating the text box in the CP (to prevent double encoding)<br />
- Fixed all auto-syndication registration to not re-html-encode section names.<br />
- Fixed issue with users in the Member Administrators role not being able to change user passwords<br />
- Fixed spelling error in the API... renamed User.EnableAvtar to User.EnableAvatar<br />
- Updated default and leanandgreen themes to hide &quot;view all users&quot; link when &quot;Display Member List&quot; is set to &quot;No&quot; in the Control Panel.<br />
- The SaveExtendedUserData call was moved into the event handler for the submit button, before the first call to sub-forms.<br />
- You can now delete a tag that is disabled.<br />
- User Points can now display without Post Points.<br />
- Fixed issue with order of permissions not being handled properly<br />
- Control Panel Report page title now shows correct text<br />
- Fix for linking over to Shutterfly showing 0x0 as the picture&#39;s size.<br />
- Fix for null reference on private messages from CS 2.x that were to users that were later deleted<br />
- Fixed ForumSqlProvider to save sticky info on edited posts<br />
- Corrected issue resulting in multiple encoding of the AvatarUrl property.<br />
- Updated edit user form in the control panel to always show the user&#39;s Username in the &quot;Alias&quot; field.<br />
- Updated blog admin control panel to properly decode the blog name.<br />
- Corrected FireFox rendering issue on user+avatar lists in the default and lean and green themes.<br />
- Fixed issue where Weblog XML-RPC pings do not get sent in some scenarios.<br />
- Corrected misplaced &lt;/div&gt; tag issue in PoisonIvy, Gertrude, Luxinterior, and Photos blog themes causing nested comments.<br />
- Changed Roller Blog add-feed sproc to set Last Modified to current time - interval, so that the feed gets pulled the next time the job runs after the feed is added.<br />
- Corrected rendering issue in the Control Panel in FireFox prior to JavaScript loading<br />
- Updated the HTMLScrubber regex to use slightly different syntax which prevents infinite loop issue in FireFox.<br />
- Corrected invalid anchor tag in blog themes.<br />
- Added check for cs_Posts.IsIndexed in all SearchBarrel-generated queries.<br />
- Fixed failed check to see if the user was anonymous within MailGateway<br />
- Fixed how SPAM blocker counts links<br />
- Fixed an issue with a missing resource label<br />
- Updated CallbackPager to always render the PagedContent contents.<br />
- Fixed issue with deserialization returning as successful when the output object is null<br />
- Blog pages now show up in the tag post list if set to be aggregated, and the aggregate options are visible when creating a new page.<br />
- Corrected thread view count to register one view per thread per rendered page regardless of the number of posts displayed on the page.<br />
- Removed script to enable/disable &quot;Join&quot; button on the registration form in the default and lean-and-green themes to prevent issues with auto-complete.<br />
- Updated TinyMCE wrapper to set the document_base_url TinyMCE option to the parent window&#39;s URL when the editor is opened in a Modal.<br />
- Fixed notifications of message being flagged for moderation by MailGateway being queued with SettingsID of 0<br />
- License usage colors are now cleared after uploading a license.<br />
- Updated truncation ellipsis markup to render within the content wrapper (link) on ObjectDataBase control.<br />
- Corrected next/previous thread links to direct to the thread&#39;s URL.<br />
- Updated UserAvatarSubForm to set the remote avatar URL (if available) when an avatar is uploaded.<br />
- cs_system_GenerateWeblogYearMonthDayList and cs_vw_weblog_PostByYearMonth now has some sql included to attempt to build the roll-up tables.<br />
- Fixed regression from Bug Fix #1391 with AppKey being a required field on the blog creation page<br />
- Selecting &#39;Hide Topics I&#39;ve Read&#39; in the forum filtered thread control now keeps the unread announcements visible on the first page<br />
- You can now delete a forum post without it sending email<br />
- Tweaks to cs_weblog_Post_Create and cs_weblog_Post_Update to ensure that UserTime was never NULL.<br />
- Corrected potential XSS issue in User RSS Feeds<br />
- Added EnsureHtmlEncoded calls to loaded TemporaryRssFeeds and TemporaryRssFeedItems content.<br />
- Updated UserSearchForm to redirect to the rewritable URL instead of directly into the current theme.<br />
- Pager fixed in the manage photo comments page so that you can page past the first 2 pages.<br />
- Membership.GetRoles result set creation updated to ensure roles and role icons are re-populated after cache expiration<br />
- Updated default Regex validation patterns for user names and passwords and ensured that these patterns always match the entire string when set.<br />
- Updated sql to only change the regex pattern if the pattern [a-zA-Z]+[^\&lt;\&gt;]* was in the UsernameRegex before<br />
- Added tabindex=&quot;-1&quot; to all TinyMCE buttons to prevent tab-stops when navigating into the editor using the keyboard.<br />
- Added validation of RSS feed URLs and external avatar URLs to ensure they are HTTP-based.<br />
- Updated SearchBarrel to require Read access from applications supporting Read permissions.<br />
- Adding &#39;]&#39; to a post no longer causes the post to pass the duplicate post check.<br />
- Disabling post emoticons now hides the emoticon radio button list from the Forum options tab<br />
- File Gallery comment URL&#39;s now work correctly, displaying the entry they belong to<br />
- Corrected issue preventing section filters from being saved.<br />
- Updated the form adapter to only update the form&#39;s action attribute when the page&#39;s URL has been rewritten by CS to ensure compatibility with external, non-rewritten pages within CS.<br />
- Updated the thread queries used by blog and file gallery search indexing to specify IgnorePermissions=true so that all blogs and file gallery posts are indexed.<br />
- Corrected infinite redirect issue when an invalid character exists in the URL.<br />
- Changed const string cacheKey = &quot;UserLookupTable&quot; to include SettingsID<br />
- Photo Gallery now supports HTMLEncoding a submitted user name field<br />
- Added ApplicationName to the UserRoleNames cache key<br />
- Corrected page height issue in IE when using tabbed panes.
</p>
